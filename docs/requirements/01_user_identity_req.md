# 需求分析文档 - 用户身份认证模块 (User Identity)

**版本**: 1.0
**状态**: 草稿
**优先级**: P0 (核心功能)

## 1. 业务背景
作为一个 AI 问答平台，用户系统是基石。我们需要识别用户身份以保存其对话历史、偏好设置以及未来的会员权益。本阶段主要完成最基础的注册与登录功能，对标现代 Web 应用的安全标准。

## 2. 用户故事 (User Stories)
1.  **作为一名游客**，我想**通过邮箱和密码注册账号**，以便开始使用 AI 问答服务。
2.  **作为一名已注册用户**，我想**通过邮箱和密码登录**，以便访问我的历史记录。
3.  **作为一名用户**，我希望**我的密码是加密存储的**，即使数据库泄露，我的密码也不会被直接还原。
4.  **作为系统**，我希望**记录用户的注册时间和最后登录时间**，以便进行用户活跃度分析。

## 3. 功能需求详情

### 3.1 用户注册 (Sign Up)
- **输入**: 邮箱 (Email), 密码 (Password), 确认密码 (ConfirmPassword).
- **校验规则**:
    - 邮箱: 必须符合标准邮箱格式。
    - 密码: 长度 8-20 位，必须包含字母和数字。
    - 确认密码: 必须与密码一致。
    - 唯一性: 邮箱在系统中必须唯一，若已存在则提示“该邮箱已被注册”。
- **输出**: 注册成功提示，或错误信息。

### 3.2 用户登录 (Sign In)
- **输入**: 邮箱, 密码.
- **校验规则**:
    - 检查邮箱是否存在。
    - 检查密码是否匹配 (比对哈希值)。
- **输出**:
    - 成功: 返回 JWT Token (Access Token) 和用户信息，前端跳转至主页。
    - 失败: 提示“账号或密码错误”。

## 4. 非功能需求 (NFR)
1.  **安全性**:
    - **密码存储**: 严禁明文存储。必须使用 `bcrypt` 或 `Argon2` 进行加盐哈希。
    - **传输安全**: 所有接口必须支持 HTTPS (开发环境 HTTP).
2.  **性能**:
    - 登录/注册接口响应时间 < 200ms (不包含哈希计算耗时，加上哈希约 500ms 内).
3.  **扩展性**:
    - 预留 OAuth2 (GitHub/Google) 登录的字段支持。
    - 预留手机号注册的支持。

## 5. 风险评估
- **撞库攻击**: 恶意用户使用常见密码字典尝试登录。
    - *对策*: 暂时不实现验证码，但设计时需预留 Rate Limiting (限流) 接口位。
